import { ethers } from "ethers";
import { ZuploContext, ZuploRequest, environment } from "@zuplo/runtime";
import { createClient } from "@supabase/supabase-js";

const { WALLET_PRIVATE_KEY, QUICKNODE_API_KEY, INFURA_API_KEY, SUPABASE_PASSWORD, SUPABASE_URL } = environment;

const RPCurl1 = 'https://attentive-convincing-pallet.matic-testnet.quiknode.pro/' + QUICKNODE_API_KEY + '/';
const RPCurl = 'https://sepolia.infura.io/v3/' + INFURA_API_KEY;

const provider = new ethers.JsonRpcProvider(RPCurl);
const wallet = new ethers.Wallet(WALLET_PRIVATE_KEY, provider);

const supabase = createClient(
  SUPABASE_URL,
  SUPABASE_PASSWORD
);

const contractBytecode = "0x60806040523480156200001157600080fd5b5060405162005c6c38038062005c6c833981810160405281019062000037919062000684565b620000576200004b620002e160201b60201c565b620002e960201b60201c565b815181600a82111580156200006e57508160075411155b80156200007c575060008114155b80156200008a575060008214155b620000cc576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620000c3906200074b565b60405180910390fd5b60005b8451811015620002b65760056000868381518110620000f357620000f26200076d565b5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161580156200019b5750600073ffffffffffffffffffffffffffffffffffffffff168582815181106200017a57620001796200076d565b5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1614155b8015620001f157503373ffffffffffffffffffffffffffffffffffffffff16858281518110620001d057620001cf6200076d565b5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1614155b62000233576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200022a90620007ec565b60405180910390fd5b6001600560008784815181106200024f576200024e6200076d565b5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508080600101915050620000cf565b508360069080519060200190620002cf929190620003ad565b5082600781905550505050506200080e565b600033905090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b82805482825590600052602060002090810192821562000429579160200282015b82811115620004285782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555091602001919060010190620003ce565b5b5090506200043891906200043c565b5090565b5b80821115620004575760008160009055506001016200043d565b5090565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b620004bf8262000474565b810181811067ffffffffffffffff82111715620004e157620004e062000485565b5b80604052505050565b6000620004f66200045b565b9050620005048282620004b4565b919050565b600067ffffffffffffffff82111562000527576200052662000485565b5b602082029050602081019050919050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006200056a826200053d565b9050919050565b6200057c816200055d565b81146200058857600080fd5b50565b6000815190506200059c8162000571565b92915050565b6000620005b9620005b38462000509565b620004ea565b90508083825260208201905060208402830185811115620005df57620005de62000538565b5b835b818110156200060c5780620005f788826200058b565b845260208401935050602081019050620005e1565b5050509392505050565b600082601f8301126200062e576200062d6200046f565b5b815162000640848260208601620005a2565b91505092915050565b6000819050919050565b6200065e8162000649565b81146200066a57600080fd5b50565b6000815190506200067e8162000653565b92915050565b600080604083850312156200069e576200069d62000465565b5b600083015167ffffffffffffffff811115620006bf57620006be6200046a565b5b620006cd8582860162000616565b9250506020620006e0858286016200066d565b9150509250929050565b600082825260208201905092915050565b7f496e76616c696420726571756972656d656e7400000000000000000000000000600082015250565b600062000733601383620006ea565b91506200074082620006fb565b602082019050919050565b60006020820190508181036000830152620007668162000724565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f496e76616c6964207369676e6572000000000000000000000000000000000000600082015250565b6000620007d4600e83620006ea565b9150620007e1826200079c565b602082019050919050565b600060208201905081810360008301526200080781620007c5565b9050919050565b61544e806200081e6000396000f3fe6080604052600436106101bb5760003560e01c8063998f24af116100ec578063bc197c811161008a578063d74f8edd11610064578063d74f8edd14610735578063dc8452cd14610760578063f23a6e611461078b578063f2fde38b146107c857610232565b8063bc197c81146106a6578063c01a8c84146106e3578063d29a4bf61461070c57610232565b8063a0602f06116100c6578063a0602f06146105c4578063a8abe69a14610601578063b5dc40c31461063e578063b77bf6001461067b57610232565b8063998f24af1461052d5780639ace38c2146105565780639e3c1b611461059b57610232565b8063715018a61161015957806382f25bf71161013357806382f25bf71461045f5780638b51d13f1461049c5780638da5cb5b146104d957806397feb9261461050457610232565b8063715018a6146103ce578063784547a7146103e55780637df73e271461042257610232565b806330f9503c1161019557806330f9503c146102ee5780633411c81c146103175780635390226014610354578063547415251461039157610232565b806301ffc9a714610237578063150b7a02146102745780632079fb9a146102b157610232565b3661023257600034111561023057600073ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f5548c837ab068cf56a2c2479df0882a4922fd203edb7517321831d95078c5f623460405161022791906135c7565b60405180910390a35b005b600080fd5b34801561024357600080fd5b5061025e6004803603810190610259919061364e565b6107f1565b60405161026b9190613696565b60405180910390f35b34801561028057600080fd5b5061029b60048036038101906102969190613881565b61086b565b6040516102a89190613913565b60405180910390f35b3480156102bd57600080fd5b506102d860048036038101906102d3919061392e565b61087f565b6040516102e5919061396a565b60405180910390f35b3480156102fa57600080fd5b5061031560048036038101906103109190613985565b6108be565b005b34801561032357600080fd5b5061033e600480360381019061033991906139c5565b610c2c565b60405161034b9190613696565b60405180910390f35b34801561036057600080fd5b5061037b60048036038101906103769190613a68565b610c5b565b60405161038891906135c7565b60405180910390f35b34801561039d57600080fd5b506103b860048036038101906103b39190613b52565b610d1e565b6040516103c591906135c7565b60405180910390f35b3480156103da57600080fd5b506103e3610dcd565b005b3480156103f157600080fd5b5061040c6004803603810190610407919061392e565b610de1565b6040516104199190613696565b60405180910390f35b34801561042e57600080fd5b5061044960048036038101906104449190613b92565b610ee4565b6040516104569190613696565b60405180910390f35b34801561046b57600080fd5b5061048660048036038101906104819190613b92565b610f04565b604051610493919061396a565b60405180910390f35b3480156104a857600080fd5b506104c360048036038101906104be919061392e565b610f37565b6040516104d091906135c7565b60405180910390f35b3480156104e557600080fd5b506104ee611018565b6040516104fb919061396a565b60405180910390f35b34801561051057600080fd5b5061052b60048036038101906105269190613bbf565b611041565b005b34801561053957600080fd5b50610554600480360381019061054f9190613985565b611189565b005b34801561056257600080fd5b5061057d6004803603810190610578919061392e565b61176d565b60405161059299989796959493929190613d04565b60405180910390f35b3480156105a757600080fd5b506105c260048036038101906105bd9190613d98565b61189d565b005b3480156105d057600080fd5b506105eb60048036038101906105e69190613985565b61197a565b6040516105f89190613696565b60405180910390f35b34801561060d57600080fd5b5061062860048036038101906106239190613deb565b6119a9565b6040516106359190613f10565b60405180910390f35b34801561064a57600080fd5b506106656004803603810190610660919061392e565b611bcf565b6040516106729190613ff0565b60405180910390f35b34801561068757600080fd5b50610690611e5a565b60405161069d91906135c7565b60405180910390f35b3480156106b257600080fd5b506106cd60048036038101906106c891906140da565b611e60565b6040516106da9190613913565b60405180910390f35b3480156106ef57600080fd5b5061070a6004803603810190610705919061392e565b611e75565b005b34801561071857600080fd5b50610733600480360381019061072e9190613bbf565b61214e565b005b34801561074157600080fd5b5061074a612226565b60405161075791906135c7565b60405180910390f35b34801561076c57600080fd5b5061077561222b565b60405161078291906135c7565b60405180910390f35b34801561079757600080fd5b506107b260048036038101906107ad91906141a9565b612231565b6040516107bf9190613913565b60405180910390f35b3480156107d457600080fd5b506107ef60048036038101906107ea9190613b92565b612246565b005b60007f4e2312e0000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614806108645750610863826122e7565b5b9050919050565b600063150b7a0260e01b9050949350505050565b6006818154811061088f57600080fd5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6108c6612351565b600560008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16610952576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109499061429d565b60405180910390fd5b600560008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16156109df576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109d690614309565b60405180910390fd5b6109e7611018565b73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610a54576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a4b90614375565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff16600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610b5057610b4f600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166123cf565b5b80600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff167f458bce772f34fc534e68a2ecbfbe97fa730845fa322a79b3b4a1481f4c8be1e160405160405180910390a35050565b60026020528160005260406000206020528060005260406000206000915091509054906101000a900460ff1681565b600033600560008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16610cea576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610ce1906143e1565b60405180910390fd5b6000610cf46124cf565b9050610d068a8a8a8a8a8a8a886124d7565b9250610d1183611e75565b5050979650505050505050565b600080600090505b600854811015610dc657838015610d5e57506001600082815260200190815260200160002060000160009054906101000a900460ff16155b8015610d705750610d6e81612756565b155b80610da45750828015610da357506001600082815260200190815260200160002060000160009054906101000a900460ff165b5b15610db957600182610db69190614430565b91505b8080600101915050610d26565b5092915050565b610dd5612351565b610ddf60006127b4565b565b6000806000905060006002600085815260200190815260200160002090506000600680549050905060005b81811015610ed65782600060068381548110610e2b57610e2a614464565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615610eb357600184610eb09190614430565b93505b6007548403610ec9576001945050505050610edf565b8080600101915050610e0c565b50600093505050505b919050565b60056020528060005260406000206000915054906101000a900460ff1681565b60036020528060005260406000206000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000806002600084815260200190815260200160002090506000600680549050905060005b818110156110105782600060068381548110610f7b57610f7a614464565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615611003576001846110009190614430565b93505b8080600101915050610f5c565b505050919050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036110b0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016110a7906144df565b60405180910390fd5b600081116110f3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016110ea9061454b565b60405180910390fd5b6111203330838573ffffffffffffffffffffffffffffffffffffffff16612878909392919063ffffffff16565b8173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fe33e9822e3317b004d587136bab2627ea1ecfbba4eb79abddd0a56cfdd09c0e18360405161117d91906135c7565b60405180910390a35050565b33600560008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16611216576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161120d906143e1565b60405180910390fd5b600460008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16156112e0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016112d7906145b7565b60405180910390fd5b8173ffffffffffffffffffffffffffffffffffffffff16600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16146113ad576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016113a490614623565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361141c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611413906146b5565b60405180910390fd5b611424611018565b73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603611491576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161148890614375565b60405180910390fd5b600560008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161561151e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161151590614309565b60405180910390fd5b6001600460008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055506115bc82612901565b15611768576115ca826123cf565b6000600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555061165283612a23565b6001600560008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055506006829080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f2d025324f0a785e8c12d0a0d91a9caa49df4ef20ff87e0df7213a1d4f3157beb60405160405180910390a35b505050565b60016020528060005260406000206000915090508060000160009054906101000a900460ff16908060000160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060020180546117ef90614704565b80601f016020809104026020016040519081016040528092919081815260200182805461181b90614704565b80156118685780601f1061183d57610100808354040283529160200191611868565b820191906000526020600020905b81548152906001019060200180831161184b57829003601f168201915b5050505050908060030160009054906101000a900460ff16908060040154908060050154908060060154908060070154905089565b8273ffffffffffffffffffffffffffffffffffffffff1663f242432a333085856040518563ffffffff1660e01b81526004016118dc949392919061475b565b600060405180830381600087803b1580156118f657600080fd5b505af115801561190a573d6000803e3d6000fd5b505050508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f81ca208a9e3cb5a41cc28eb453c2f9b8433e6306fb145713f0b2c3e707f60456848460405161196d9291906147b3565b60405180910390a3505050565b60046020528160005260406000206020528060005260406000206000915091509054906101000a900460ff1681565b60608385106119ed576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016119e49061484e565b60405180910390fd5b6119f985600854612c6d565b9450611a0784600854612c86565b935060008585611a17919061486e565b67ffffffffffffffff811115611a3057611a2f613756565b5b604051908082528060200260200182016040528015611a5e5781602001602082028036833780820191505090505b5090506000808790505b86811015611b2657858015611a9e57506001600082815260200190815260200160002060000160009054906101000a900460ff16155b8015611ab05750611aae81612756565b155b80611ae45750848015611ae357506001600082815260200190815260200160002060000160009054906101000a900460ff165b5b15611b195780838381518110611afd57611afc614464565b5b602002602001018181525050600182611b169190614430565b91505b8080600101915050611a68565b508067ffffffffffffffff811115611b4157611b40613756565b5b604051908082528060200260200182016040528015611b6f5781602001602082028036833780820191505090505b50925060005b81811015611bc457828181518110611b9057611b8f614464565b5b6020026020010151848281518110611bab57611baa614464565b5b6020026020010181815250508080600101915050611b75565b505050949350505050565b60606000600680549050905060008167ffffffffffffffff811115611bf757611bf6613756565b5b604051908082528060200260200182016040528015611c255781602001602082028036833780820191505090505b50905060006002600086815260200190815260200160002090506000805b84811015611d835782600060068381548110611c6257611c61614464565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615611d765760068181548110611cee57611ced614464565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16848381518110611d2c57611d2b614464565b5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050600182611d739190614430565b91505b8080600101915050611c43565b8167ffffffffffffffff811115611d9d57611d9c613756565b5b604051908082528060200260200182016040528015611dcb5781602001602082028036833780820191505090505b509550600090505b81811015611e5057838181518110611dee57611ded614464565b5b6020026020010151868281518110611e0957611e08614464565b5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508080600101915050611dd3565b5050505050919050565b60085481565b600063bc197c8160e01b905095945050505050565b33600560008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16611f02576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611ef9906143e1565b60405180910390fd5b81600073ffffffffffffffffffffffffffffffffffffffff166001600083815260200190815260200160002060000160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603611fa8576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611f9f906148ee565b60405180910390fd5b82336002600083815260200190815260200160002060008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615612048576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161203f9061495a565b60405180910390fd5b61205185612756565b15612091576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612088906149c6565b60405180910390fd5b60016002600087815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550843373ffffffffffffffffffffffffffffffffffffffff167f4a504a94899432a9846e1aa406dceb1bcfd538bb839071d49d1e5e23f5be30ef60405160405180910390a361214785612c9f565b5050505050565b8173ffffffffffffffffffffffffffffffffffffffff166342842e0e3330846040518463ffffffff1660e01b815260040161218b939291906149e6565b600060405180830381600087803b1580156121a557600080fd5b505af11580156121b9573d6000803e3d6000fd5b505050508173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f20d9d42fbcdd65fce5c3986b701b04ffb8e09852d04a93422dd4be124ae10a8e8360405161221a91906135c7565b60405180910390a35050565b600a81565b60075481565b600063f23a6e6160e01b905095945050505050565b61224e612351565b600560008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16156122db576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016122d290614a8f565b60405180910390fd5b6122e481613230565b50565b60007f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b6123596132b3565b73ffffffffffffffffffffffffffffffffffffffff16612377611018565b73ffffffffffffffffffffffffffffffffffffffff16146123cd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016123c490614afb565b60405180910390fd5b565b600060068054905090506000600460008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020905060005b828110156124c9576000826000600684815481106124405761243f614464565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550808060010191505061241f565b50505050565b600042905090565b600088600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603612549576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161254090614b67565b60405180910390fd5b60085491506040518061012001604052806000151581526020018b73ffffffffffffffffffffffffffffffffffffffff1681526020018a73ffffffffffffffffffffffffffffffffffffffff1681526020018681526020018960038111156125b4576125b3613c8d565b5b8152602001888152602001878152602001858152602001848152506001600084815260200190815260200160002060008201518160000160006101000a81548160ff02191690831515021790555060208201518160000160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060608201518160020190816126a59190614d33565b5060808201518160030160006101000a81548160ff021916908360038111156126d1576126d0613c8d565b5b021790555060a0820151816004015560c0820151816005015560e0820151816006015561010082015181600701559050506001600860008282546127159190614430565b92505081905550817fc0ba8fe4b176c1714197d43b9cc6bcf797a4a7461c5fe8d0ef6e184ae7601e5160405160405180910390a25098975050505050505050565b600080600160008481526020019081526020016000209050806006015481600701546127829190614430565b61278a6124cf565b108061279a575060008160060154145b156127a95760009150506127af565b60019150505b919050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b6128fb846323b872dd60e01b858585604051602401612899939291906149e6565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506132bb565b50505050565b6000806006805490509050600080600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020905060005b8381108015612963575060075483105b15612a13578160006006838154811061297f5761297e614464565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615612a06578280612a0290614e05565b9350505b8080600101915050612953565b5060075482149350505050919050565b600560008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615612c6a576000600680549050905060005b81811015612c67578273ffffffffffffffffffffffffffffffffffffffff1660068281548110612ab557612ab4614464565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603612c5a57600182612b08919061486e565b8114612bb6576006600183612b1d919061486e565b81548110612b2e57612b2d614464565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1660068281548110612b6d57612b6c614464565b5b9060005260206000200160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b6006805480612bc857612bc7614e4d565b5b6001900381819060005260206000200160006101000a81549073ffffffffffffffffffffffffffffffffffffffff021916905590556000600560008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550612c67565b8080600101915050612a82565b50505b50565b6000818310612c7c5781612c7e565b825b905092915050565b6000818311612c955781612c97565b825b905092915050565b806001600082815260200190815260200160002060000160009054906101000a900460ff1615612d04576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612cfb90614ec8565b60405180910390fd5b612d0d82610de1565b1561322c57600060016000848152602001908152602001600020905060018160000160006101000a81548160ff021916908315150217905550600380811115612d5957612d58613c8d565b5b8160030160009054906101000a900460ff166003811115612d7d57612d7c613c8d565b5b03612eeb578060050154471015612dc9576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612dc090614f34565b60405180910390fd5b60008160000160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16826005015483600201604051612e1c9190614fe2565b60006040518083038185875af1925050503d8060008114612e59576040519150601f19603f3d011682016040523d82523d6000602084013e612e5e565b606091505b505090508015612e9a57837f33e13ecb54c3076d8e8bb8c2881800a4d972b792045ffae98fdf46df365fed7560405160405180910390a2612ee5565b837f526441bb6c1aba3c9a4a6ca1d6545da9c2333c8c48343ef398eb858d72b7923660405160405180910390a260008260000160006101000a81548160ff0219169083151502179055505b5061322a565b60006003811115612eff57612efe613c8d565b5b8160030160009054906101000a900460ff166003811115612f2357612f22613c8d565b5b03612fd157612f9f8160000160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1682600501548360010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166133829092919063ffffffff16565b827f33e13ecb54c3076d8e8bb8c2881800a4d972b792045ffae98fdf46df365fed7560405160405180910390a2613229565b60016003811115612fe557612fe4613c8d565b5b8160030160009054906101000a900460ff16600381111561300957613008613c8d565b5b036130fb578060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166342842e0e308360000160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1684600401546040518463ffffffff1660e01b81526004016130979392919061504e565b600060405180830381600087803b1580156130b157600080fd5b505af11580156130c5573d6000803e3d6000fd5b50505050827f33e13ecb54c3076d8e8bb8c2881800a4d972b792045ffae98fdf46df365fed7560405160405180910390a2613228565b6002600381111561310f5761310e613c8d565b5b8160030160009054906101000a900460ff16600381111561313357613132613c8d565b5b03613227578060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663f242432a308360000160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff16846004015485600501546040518563ffffffff1660e01b81526004016131c79493929190615085565b600060405180830381600087803b1580156131e157600080fd5b505af11580156131f5573d6000803e3d6000fd5b50505050827f33e13ecb54c3076d8e8bb8c2881800a4d972b792045ffae98fdf46df365fed7560405160405180910390a25b5b5b5b505b5050565b613238612351565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036132a7576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161329e9061514f565b60405180910390fd5b6132b0816127b4565b50565b600033905090565b600061331d826040518060400160405280602081526020017f5361666545524332303a206c6f772d6c6576656c2063616c6c206661696c65648152508573ffffffffffffffffffffffffffffffffffffffff166134089092919063ffffffff16565b905060008151111561337d578080602001905181019061333d9190615184565b61337c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161337390615223565b60405180910390fd5b5b505050565b6134038363a9059cbb60e01b84846040516024016133a1929190615243565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506132bb565b505050565b60606134178484600085613420565b90509392505050565b606082471015613465576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161345c906152de565b60405180910390fd5b61346e85613534565b6134ad576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016134a49061534a565b60405180910390fd5b6000808673ffffffffffffffffffffffffffffffffffffffff1685876040516134d6919061539b565b60006040518083038185875af1925050503d8060008114613513576040519150601f19603f3d011682016040523d82523d6000602084013e613518565b606091505b5091509150613528828286613547565b92505050949350505050565b600080823b905060008111915050919050565b60608315613557578290506135a7565b60008351111561356a5782518084602001fd5b816040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161359e91906153f6565b60405180910390fd5b9392505050565b6000819050919050565b6135c1816135ae565b82525050565b60006020820190506135dc60008301846135b8565b92915050565b6000604051905090565b600080fd5b600080fd5b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b61362b816135f6565b811461363657600080fd5b50565b60008135905061364881613622565b92915050565b600060208284031215613664576136636135ec565b5b600061367284828501613639565b91505092915050565b60008115159050919050565b6136908161367b565b82525050565b60006020820190506136ab6000830184613687565b92915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006136dc826136b1565b9050919050565b6136ec816136d1565b81146136f757600080fd5b50565b600081359050613709816136e3565b92915050565b613718816135ae565b811461372357600080fd5b50565b6000813590506137358161370f565b92915050565b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61378e82613745565b810181811067ffffffffffffffff821117156137ad576137ac613756565b5b80604052505050565b60006137c06135e2565b90506137cc8282613785565b919050565b600067ffffffffffffffff8211156137ec576137eb613756565b5b6137f582613745565b9050602081019050919050565b82818337600083830152505050565b600061382461381f846137d1565b6137b6565b9050828152602081018484840111156138405761383f613740565b5b61384b848285613802565b509392505050565b600082601f8301126138685761386761373b565b5b8135613878848260208601613811565b91505092915050565b6000806000806080858703121561389b5761389a6135ec565b5b60006138a9878288016136fa565b94505060206138ba878288016136fa565b93505060406138cb87828801613726565b925050606085013567ffffffffffffffff8111156138ec576138eb6135f1565b5b6138f887828801613853565b91505092959194509250565b61390d816135f6565b82525050565b60006020820190506139286000830184613904565b92915050565b600060208284031215613944576139436135ec565b5b600061395284828501613726565b91505092915050565b613964816136d1565b82525050565b600060208201905061397f600083018461395b565b92915050565b6000806040838503121561399c5761399b6135ec565b5b60006139aa858286016136fa565b92505060206139bb858286016136fa565b9150509250929050565b600080604083850312156139dc576139db6135ec565b5b60006139ea85828601613726565b92505060206139fb858286016136fa565b9150509250929050565b6000613a10826136b1565b9050919050565b613a2081613a05565b8114613a2b57600080fd5b50565b600081359050613a3d81613a17565b92915050565b60048110613a5057600080fd5b50565b600081359050613a6281613a43565b92915050565b600080600080600080600060e0888a031215613a8757613a866135ec565b5b6000613a958a828b01613a2e565b9750506020613aa68a828b016136fa565b9650506040613ab78a828b01613a53565b9550506060613ac88a828b01613726565b9450506080613ad98a828b01613726565b93505060a088013567ffffffffffffffff811115613afa57613af96135f1565b5b613b068a828b01613853565b92505060c0613b178a828b01613726565b91505092959891949750929550565b613b2f8161367b565b8114613b3a57600080fd5b50565b600081359050613b4c81613b26565b92915050565b60008060408385031215613b6957613b686135ec565b5b6000613b7785828601613b3d565b9250506020613b8885828601613b3d565b9150509250929050565b600060208284031215613ba857613ba76135ec565b5b6000613bb6848285016136fa565b91505092915050565b60008060408385031215613bd657613bd56135ec565b5b6000613be4858286016136fa565b9250506020613bf585828601613726565b9150509250929050565b613c0881613a05565b82525050565b600081519050919050565b600082825260208201905092915050565b60005b83811015613c48578082015181840152602081019050613c2d565b60008484015250505050565b6000613c5f82613c0e565b613c698185613c19565b9350613c79818560208601613c2a565b613c8281613745565b840191505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b60048110613ccd57613ccc613c8d565b5b50565b6000819050613cde82613cbc565b919050565b6000613cee82613cd0565b9050919050565b613cfe81613ce3565b82525050565b600061012082019050613d1a600083018c613687565b613d27602083018b613bff565b613d34604083018a61395b565b8181036060830152613d468189613c54565b9050613d556080830188613cf5565b613d6260a08301876135b8565b613d6f60c08301866135b8565b613d7c60e08301856135b8565b613d8a6101008301846135b8565b9a9950505050505050505050565b600080600060608486031215613db157613db06135ec565b5b6000613dbf868287016136fa565b9350506020613dd086828701613726565b9250506040613de186828701613726565b9150509250925092565b60008060008060808587031215613e0557613e046135ec565b5b6000613e1387828801613726565b9450506020613e2487828801613726565b9350506040613e3587828801613b3d565b9250506060613e4687828801613b3d565b91505092959194509250565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b613e87816135ae565b82525050565b6000613e998383613e7e565b60208301905092915050565b6000602082019050919050565b6000613ebd82613e52565b613ec78185613e5d565b9350613ed283613e6e565b8060005b83811015613f03578151613eea8882613e8d565b9750613ef583613ea5565b925050600181019050613ed6565b5085935050505092915050565b60006020820190508181036000830152613f2a8184613eb2565b905092915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b613f67816136d1565b82525050565b6000613f798383613f5e565b60208301905092915050565b6000602082019050919050565b6000613f9d82613f32565b613fa78185613f3d565b9350613fb283613f4e565b8060005b83811015613fe3578151613fca8882613f6d565b9750613fd583613f85565b925050600181019050613fb6565b5085935050505092915050565b6000602082019050818103600083015261400a8184613f92565b905092915050565b600067ffffffffffffffff82111561402d5761402c613756565b5b602082029050602081019050919050565b600080fd5b600061405661405184614012565b6137b6565b905080838252602082019050602084028301858111156140795761407861403e565b5b835b818110156140a2578061408e8882613726565b84526020840193505060208101905061407b565b5050509392505050565b600082601f8301126140c1576140c061373b565b5b81356140d1848260208601614043565b91505092915050565b600080600080600060a086880312156140f6576140f56135ec565b5b6000614104888289016136fa565b9550506020614115888289016136fa565b945050604086013567ffffffffffffffff811115614136576141356135f1565b5b614142888289016140ac565b935050606086013567ffffffffffffffff811115614163576141626135f1565b5b61416f888289016140ac565b925050608086013567ffffffffffffffff8111156141905761418f6135f1565b5b61419c88828901613853565b9150509295509295909350565b600080600080600060a086880312156141c5576141c46135ec565b5b60006141d3888289016136fa565b95505060206141e4888289016136fa565b94505060406141f588828901613726565b935050606061420688828901613726565b925050608086013567ffffffffffffffff811115614227576142266135f1565b5b61423388828901613853565b9150509295509295909350565b600082825260208201905092915050565b7f4f6c64207369676e657220646f6573206e6f742065786973742e000000000000600082015250565b6000614287601a83614240565b915061429282614251565b602082019050919050565b600060208201905081810360008301526142b68161427a565b9050919050565b7f4e6577207369676e657220697320616c72656164792061207369676e65722e00600082015250565b60006142f3601f83614240565b91506142fe826142bd565b602082019050919050565b60006020820190508181036000830152614322816142e6565b9050919050565b7f4f6e7765722063616e6e6f742062652061207369676e65722e00000000000000600082015250565b600061435f601983614240565b915061436a82614329565b602082019050919050565b6000602082019050818103600083015261438e81614352565b9050919050565b7f5369676e657220646f6573206e6f742065786973740000000000000000000000600082015250565b60006143cb601583614240565b91506143d682614395565b602082019050919050565b600060208201905081810360008301526143fa816143be565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061443b826135ae565b9150614446836135ae565b925082820190508082111561445e5761445d614401565b5b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f696e76616c696420746f6b656e00000000000000000000000000000000000000600082015250565b60006144c9600d83614240565b91506144d482614493565b602082019050919050565b600060208201905081810360008301526144f8816144bc565b9050919050565b7f696e76616c696420616d6f756e74000000000000000000000000000000000000600082015250565b6000614535600e83614240565b9150614540826144ff565b602082019050919050565b6000602082019050818103600083015261456481614528565b9050919050565b7f596f7520616c726561647920636f6e6669726d65642e00000000000000000000600082015250565b60006145a1601683614240565b91506145ac8261456b565b602082019050919050565b600060208201905081810360008301526145d081614594565b9050919050565b7f4e6577207369676e6572206164647265737320696e76616c69642e0000000000600082015250565b600061460d601b83614240565b9150614618826145d7565b602082019050919050565b6000602082019050818103600083015261463c81614600565b9050919050565b7f4e6f2070656e64696e67207369676e657220757064617465207265717565737460008201527f2e00000000000000000000000000000000000000000000000000000000000000602082015250565b600061469f602183614240565b91506146aa82614643565b604082019050919050565b600060208201905081810360008301526146ce81614692565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061471c57607f821691505b60208210810361472f5761472e6146d5565b5b50919050565b50565b6000614745600083613c19565b915061475082614735565b600082019050919050565b600060a082019050614770600083018761395b565b61477d602083018661395b565b61478a60408301856135b8565b61479760608301846135b8565b81810360808301526147a881614738565b905095945050505050565b60006040820190506147c860008301856135b8565b6147d560208301846135b8565b9392505050565b7f496e76616c69642072616e67653a2066726f6d206d757374206265206c65737360008201527f207468616e20746f000000000000000000000000000000000000000000000000602082015250565b6000614838602883614240565b9150614843826147dc565b604082019050919050565b600060208201905081810360008301526148678161482b565b9050919050565b6000614879826135ae565b9150614884836135ae565b925082820390508181111561489c5761489b614401565b5b92915050565b7f5472616e73616374696f6e20646f6573206e6f74206578697374000000000000600082015250565b60006148d8601a83614240565b91506148e3826148a2565b602082019050919050565b60006020820190508181036000830152614907816148cb565b9050919050565b7f5472616e73616374696f6e20616c726561647920636f6e6669726d6564000000600082015250565b6000614944601d83614240565b915061494f8261490e565b602082019050919050565b6000602082019050818103600083015261497381614937565b9050919050565b7f5472616e73616374696f6e2074696d6564206f75742e00000000000000000000600082015250565b60006149b0601683614240565b91506149bb8261497a565b602082019050919050565b600060208201905081810360008301526149df816149a3565b9050919050565b60006060820190506149fb600083018661395b565b614a08602083018561395b565b614a1560408301846135b8565b949350505050565b7f4f776e61626c653a206e6577206f776e65722063616e6e6f742062652073696760008201527f6e65722e00000000000000000000000000000000000000000000000000000000602082015250565b6000614a79602483614240565b9150614a8482614a1d565b604082019050919050565b60006020820190508181036000830152614aa881614a6c565b9050919050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b6000614ae5602083614240565b9150614af082614aaf565b602082019050919050565b60006020820190508181036000830152614b1481614ad8565b9050919050565b7f416464726573732063616e6e6f74206265206e756c6c00000000000000000000600082015250565b6000614b51601683614240565b9150614b5c82614b1b565b602082019050919050565b60006020820190508181036000830152614b8081614b44565b9050919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302614be97fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82614bac565b614bf38683614bac565b95508019841693508086168417925050509392505050565b6000819050919050565b6000614c30614c2b614c26846135ae565b614c0b565b6135ae565b9050919050565b6000819050919050565b614c4a83614c15565b614c5e614c5682614c37565b848454614bb9565b825550505050565b600090565b614c73614c66565b614c7e818484614c41565b505050565b5b81811015614ca257614c97600082614c6b565b600181019050614c84565b5050565b601f821115614ce757614cb881614b87565b614cc184614b9c565b81016020851015614cd0578190505b614ce4614cdc85614b9c565b830182614c83565b50505b505050565b600082821c905092915050565b6000614d0a60001984600802614cec565b1980831691505092915050565b6000614d238383614cf9565b9150826002028217905092915050565b614d3c82613c0e565b67ffffffffffffffff811115614d5557614d54613756565b5b614d5f8254614704565b614d6a828285614ca6565b600060209050601f831160018114614d9d5760008415614d8b578287015190505b614d958582614d17565b865550614dfd565b601f198416614dab86614b87565b60005b82811015614dd357848901518255600182019150602085019450602081019050614dae565b86831015614df05784890151614dec601f891682614cf9565b8355505b6001600288020188555050505b505050505050565b6000614e10826135ae565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203614e4257614e41614401565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603160045260246000fd5b7f5472616e73616374696f6e20616c726561647920657865637574656400000000600082015250565b6000614eb2601c83614240565b9150614ebd82614e7c565b602082019050919050565b60006020820190508181036000830152614ee181614ea5565b9050919050565b7f6e6f7420656e6f75676820616d6f756e7420746f207769746864726177000000600082015250565b6000614f1e601d83614240565b9150614f2982614ee8565b602082019050919050565b60006020820190508181036000830152614f4d81614f11565b9050919050565b600081905092915050565b60008154614f6c81614704565b614f768186614f54565b94506001821660008114614f915760018114614fa657614fd9565b60ff1983168652811515820286019350614fd9565b614faf85614b87565b60005b83811015614fd157815481890152600182019150602081019050614fb2565b838801955050505b50505092915050565b6000614fee8284614f5f565b915081905092915050565b600061501461500f61500a846136b1565b614c0b565b6136b1565b9050919050565b600061502682614ff9565b9050919050565b60006150388261501b565b9050919050565b6150488161502d565b82525050565b6000606082019050615063600083018661395b565b615070602083018561503f565b61507d60408301846135b8565b949350505050565b600060a08201905061509a600083018761395b565b6150a7602083018661503f565b6150b460408301856135b8565b6150c160608301846135b8565b81810360808301526150d281614738565b905095945050505050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b6000615139602683614240565b9150615144826150dd565b604082019050919050565b600060208201905081810360008301526151688161512c565b9050919050565b60008151905061517e81613b26565b92915050565b60006020828403121561519a576151996135ec565b5b60006151a88482850161516f565b91505092915050565b7f5361666545524332303a204552433230206f7065726174696f6e20646964206e60008201527f6f74207375636365656400000000000000000000000000000000000000000000602082015250565b600061520d602a83614240565b9150615218826151b1565b604082019050919050565b6000602082019050818103600083015261523c81615200565b9050919050565b6000604082019050615258600083018561395b565b61526560208301846135b8565b9392505050565b7f416464726573733a20696e73756666696369656e742062616c616e636520666f60008201527f722063616c6c0000000000000000000000000000000000000000000000000000602082015250565b60006152c8602683614240565b91506152d38261526c565b604082019050919050565b600060208201905081810360008301526152f7816152bb565b9050919050565b7f416464726573733a2063616c6c20746f206e6f6e2d636f6e7472616374000000600082015250565b6000615334601d83614240565b915061533f826152fe565b602082019050919050565b6000602082019050818103600083015261536381615327565b9050919050565b600061537582613c0e565b61537f8185614f54565b935061538f818560208601613c2a565b80840191505092915050565b60006153a7828461536a565b915081905092915050565b600081519050919050565b60006153c8826153b2565b6153d28185614240565b93506153e2818560208601613c2a565b6153eb81613745565b840191505092915050565b6000602082019050818103600083015261541081846153bd565b90509291505056fea2646970667358221220065f01cf62a31727cb89bf3c8fe7611bce131070407e97446f7c827d4f381c2664736f6c63430008130033";
const contractABI = [
  {
    "inputs": [
      {
        "internalType": "address[]",
        "name": "_signers",
        "type": "address[]"
      },
      {
        "internalType": "uint256",
        "name": "_required",
        "type": "uint256"
      }
    ],
    "stateMutability": "nonpayable",
    "type": "constructor"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "sender",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "uint256",
        "name": "transactionId",
        "type": "uint256"
      }
    ],
    "name": "Confirmation",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "sender",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "token",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "value",
        "type": "uint256"
      }
    ],
    "name": "Deposit",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "sender",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "token",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "value",
        "type": "uint256"
      }
    ],
    "name": "ERC1155Deposited",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "sender",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "token",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "value",
        "type": "uint256"
      }
    ],
    "name": "ERC20Deposited",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "sender",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "token",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      }
    ],
    "name": "ERC721Deposited",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "uint256",
        "name": "transactionId",
        "type": "uint256"
      }
    ],
    "name": "Execution",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "uint256",
        "name": "transactionId",
        "type": "uint256"
      }
    ],
    "name": "ExecutionFailure",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "previousOwner",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "newOwner",
        "type": "address"
      }
    ],
    "name": "OwnershipTransferred",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "sender",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "uint256",
        "name": "transactionId",
        "type": "uint256"
      }
    ],
    "name": "Revocation",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "currentSigner",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "newSigner",
        "type": "address"
      }
    ],
    "name": "SignerChangeRequested",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "oldSigner",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "newSigner",
        "type": "address"
      }
    ],
    "name": "SignerUpdated",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "uint256",
        "name": "transactionId",
        "type": "uint256"
      }
    ],
    "name": "Submission",
    "type": "event"
  },
  {
    "inputs": [],
    "name": "MAX_OWNER_COUNT",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "_oldSigner",
        "type": "address"
      },
      {
        "internalType": "address",
        "name": "_newSigner",
        "type": "address"
      }
    ],
    "name": "confirmSignerChange",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "transactionId",
        "type": "uint256"
      }
    ],
    "name": "confirmTransaction",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "name": "confirmations",
    "outputs": [
      {
        "internalType": "bool",
        "name": "",
        "type": "bool"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "token",
        "type": "address"
      },
      {
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
    ],
    "name": "depositERC1155",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "token",
        "type": "address"
      },
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
    ],
    "name": "depositERC20",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "token",
        "type": "address"
      },
      {
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      }
    ],
    "name": "depositERC721",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "transactionId",
        "type": "uint256"
      }
    ],
    "name": "getConfirmationCount",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "count",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "transactionId",
        "type": "uint256"
      }
    ],
    "name": "getConfirmations",
    "outputs": [
      {
        "internalType": "address[]",
        "name": "_confirmations",
        "type": "address[]"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "bool",
        "name": "pending",
        "type": "bool"
      },
      {
        "internalType": "bool",
        "name": "executed",
        "type": "bool"
      }
    ],
    "name": "getTransactionCount",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "count",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "from",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "to",
        "type": "uint256"
      },
      {
        "internalType": "bool",
        "name": "pending",
        "type": "bool"
      },
      {
        "internalType": "bool",
        "name": "executed",
        "type": "bool"
      }
    ],
    "name": "getTransactionIds",
    "outputs": [
      {
        "internalType": "uint256[]",
        "name": "_transactionIds",
        "type": "uint256[]"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "transactionId",
        "type": "uint256"
      }
    ],
    "name": "isConfirmed",
    "outputs": [
      {
        "internalType": "bool",
        "name": "",
        "type": "bool"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "name": "isSigner",
    "outputs": [
      {
        "internalType": "bool",
        "name": "",
        "type": "bool"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      },
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      },
      {
        "internalType": "uint256[]",
        "name": "",
        "type": "uint256[]"
      },
      {
        "internalType": "uint256[]",
        "name": "",
        "type": "uint256[]"
      },
      {
        "internalType": "bytes",
        "name": "",
        "type": "bytes"
      }
    ],
    "name": "onERC1155BatchReceived",
    "outputs": [
      {
        "internalType": "bytes4",
        "name": "",
        "type": "bytes4"
      }
    ],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      },
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "bytes",
        "name": "",
        "type": "bytes"
      }
    ],
    "name": "onERC1155Received",
    "outputs": [
      {
        "internalType": "bytes4",
        "name": "",
        "type": "bytes4"
      }
    ],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      },
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      },
      {
        "internalType": "bytes",
        "name": "",
        "type": "bytes"
      }
    ],
    "name": "onERC721Received",
    "outputs": [
      {
        "internalType": "bytes4",
        "name": "",
        "type": "bytes4"
      }
    ],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "owner",
    "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "renounceOwnership",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "_oldSigner",
        "type": "address"
      },
      {
        "internalType": "address",
        "name": "_newSigner",
        "type": "address"
      }
    ],
    "name": "requestSignerChange",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "required",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      },
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "name": "signerChangeConfirmations",
    "outputs": [
      {
        "internalType": "bool",
        "name": "",
        "type": "bool"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "name": "signerChangeRequests",
    "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "signers",
    "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address payable",
        "name": "destination",
        "type": "address"
      },
      {
        "internalType": "address",
        "name": "token",
        "type": "address"
      },
      {
        "internalType": "enum MultiSigWallet.TokenStandard",
        "name": "ts",
        "type": "uint8"
      },
      {
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "value",
        "type": "uint256"
      },
      {
        "internalType": "bytes",
        "name": "data",
        "type": "bytes"
      },
      {
        "internalType": "uint256",
        "name": "confirmTimestamp",
        "type": "uint256"
      }
    ],
    "name": "submitTransaction",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "transactionId",
        "type": "uint256"
      }
    ],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "bytes4",
        "name": "interfaceId",
        "type": "bytes4"
      }
    ],
    "name": "supportsInterface",
    "outputs": [
      {
        "internalType": "bool",
        "name": "",
        "type": "bool"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "transactionCount",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "transactions",
    "outputs": [
      {
        "internalType": "bool",
        "name": "executed",
        "type": "bool"
      },
      {
        "internalType": "address payable",
        "name": "destination",
        "type": "address"
      },
      {
        "internalType": "address",
        "name": "token",
        "type": "address"
      },
      {
        "internalType": "bytes",
        "name": "data",
        "type": "bytes"
      },
      {
        "internalType": "enum MultiSigWallet.TokenStandard",
        "name": "ts",
        "type": "uint8"
      },
      {
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "value",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "confirmTimestamp",
        "type": "uint256"
      },
      {
        "internalType": "uint256",
        "name": "txTimestamp",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "newOwner",
        "type": "address"
      }
    ],
    "name": "transferOwnership",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "stateMutability": "payable",
    "type": "receive"
  }
];

const contractFactory = new ethers.ContractFactory(contractABI, contractBytecode, wallet);

export default async function (request: ZuploRequest, context: ZuploContext) {
  const req = await request.json()

  const bodyreq_signers = await req.signers;
  if (typeof bodyreq_signers != "object") {
    return {
      error: "Invalid argument type of signers",
    };
  }
  if (bodyreq_signers.length < 2 || bodyreq_signers.length > 10) {
    return {
      error: "Invalid number of signers, expected between 2 and 10",
    };
  }
  for (let i = 0; i < bodyreq_signers.length; i++) {
    if (typeof bodyreq_signers[i] != "string" || bodyreq_signers[i].length != 42 || bodyreq_signers[i].slice(0, 2) != "0x") {
      return {
        error: "Invalid argument type of signers at index " + i + " (current argument at index " + i + " : \'" + bodyreq_signers[i] + "\')",
      };
    } else {
      for (let j = 2; j < 42; j++) {
        if (bodyreq_signers[i][j] < "0" || bodyreq_signers[i][j] > "9") {
          if (bodyreq_signers[i][j] < "A" || bodyreq_signers[i][j] > "F") {
            if (bodyreq_signers[i][j] < "a" || bodyreq_signers[i][j] > "f") {
              return {
                error: "Invalid character at index " + j + " of signers at index " + i + " (current character at index " + j + " : \'" + bodyreq_signers[i][j] + "\')",
              };
            }
          }
        }
      }
    }
  }

  const bodyreq_required = await req.required;
  if (typeof bodyreq_required != "number") {
    return {
      error: "Invalid argument type of required",
    };
  }
  if (bodyreq_required < 1 || bodyreq_required > bodyreq_signers.length) {
    return {
      error: "Invalid number of required, expected between 1 and the number of signers (in your request : " + bodyreq_signers.length + " signers)",
    };
  }

  const nonce = await wallet.getNonce();

  const constructorArgs = [bodyreq_signers, bodyreq_required];
  const encodeConstructorArgs = contractFactory.interface.encodeDeploy(constructorArgs);
  const contractData = contractBytecode + encodeConstructorArgs.slice(2);

  const tx = {
    nonce: nonce,
    to: null,
    value: 0,
    gasPrice: 2860267955,
    gasLimit: 21000000,
    data: contractData,
    chainId: 11155111,
  };
  const sendTxResponse = await wallet.sendTransaction(tx);

  const network = await provider.getNetwork();

  try {
    const { error } = await supabase
      .from("contracts")
      .insert([
        { creation_hash: sendTxResponse.hash.toString(), network: network.name.toString(), chain_id: network.chainId.toString(), owner: request.user.data.customerId.toString() }
      ])
    if (error) {
      return {
        smallError: "Error while inserting the contract's data in the database",
        error: error,
      };
    }
  } catch (err) {
    return {
      smallError: "Error while inserting the contract's data in the database",
      error: err,
    };
  }


  return {
    success: "Transaction sent successfully",
    sendTxResponse: sendTxResponse.hash,
    network: network,
  };
};
